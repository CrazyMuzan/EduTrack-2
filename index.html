

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body{font-family:system-ui,-apple-system,sans-serif;background:#f0f4f8}
        .login-bg{background:linear-gradient(135deg,#3b82f6,#1e40af)}
        .glass-card{background:rgba(255,255,255,0.25);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.18);box-shadow:0 8px 32px rgba(31,38,135,0.37)}
        .card-hover:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,0.1);transition:all 0.3s}
        .tab-active{border-bottom:3px solid #3b82f6;color:#1e40af;font-weight:600}
        .avatar-placeholder{background:#e5e7eb;display:flex;align-items:center;justify-content:center;color:#9ca3af;font-weight:bold}
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center login-bg p-4">
        <div class="glass-card rounded-xl p-8 w-full max-w-md">
            <h1 class="text-3xl font-bold text-white text-center mb-2">Online Tracker</h1>
            <p class="text-blue-100 text-center mb-6">Sign in to access the dashboard</p>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-white mb-1 text-sm">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-2 rounded-lg bg-white bg-opacity-20 border border-blue-300 text-white" required>
                </div>
                <div>
                    <label class="block text-white mb-1 text-sm">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-2 rounded-lg bg-white bg-opacity-20 border border-blue-300 text-white" required>
                </div>
                <button type="submit" class="w-full bg-white text-blue-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-50 mt-2">Sign In</button>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainDashboard" class="hidden min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="bg-white shadow-md">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <h1 class="text-xl font-bold text-blue-800">Student Tracker</h1>
                <div class="flex items-center">
                    <span class="text-sm mr-2 hidden sm:block">Admin User</span>
                    <div class="h-8 w-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold">A</div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-6">
            <!-- Sections View -->
            <div id="sectionsView">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Class Sections</h2>
                    <button id="addStudentBtn" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm">+ Add Student</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Section Cards -->
                    <div class="card-hover bg-white rounded-lg shadow-sm overflow-hidden border border-gray-100">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-700 px-4 py-3">
                            <h3 class="text-lg font-bold text-white">Section A</h3>
                            <p class="text-blue-100 text-xs">Grade 10</p>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center">
                                <p class="text-gray-600 text-sm">Students: <span id="sectionACount">0</span></p>
                                <button class="text-blue-600 text-sm" onclick="viewSection('A')">View All</button>
                            </div>
                        </div>
                    </div>

                    <div class="card-hover bg-white rounded-lg shadow-sm overflow-hidden border border-gray-100">
                        <div class="bg-gradient-to-r from-purple-500 to-purple-700 px-4 py-3">
                            <h3 class="text-lg font-bold text-white">Section B</h3>
                            <p class="text-purple-100 text-xs">Grade 10</p>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center">
                                <p class="text-gray-600 text-sm">Students: <span id="sectionBCount">0</span></p>
                                <button class="text-purple-600 text-sm" onclick="viewSection('B')">View All</button>
                            </div>
                        </div>
                    </div>

                    <div class="card-hover bg-white rounded-lg shadow-sm overflow-hidden border border-gray-100">
                        <div class="bg-gradient-to-r from-green-500 to-green-700 px-4 py-3">
                            <h3 class="text-lg font-bold text-white">Section C</h3>
                            <p class="text-green-100 text-xs">Grade 10</p>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center">
                                <p class="text-gray-600 text-sm">Students: <span id="sectionCCount">0</span></p>
                                <button class="text-green-600 text-sm" onclick="viewSection('C')">View All</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-hover bg-white rounded-lg shadow-sm overflow-hidden border border-gray-100">
                        <div class="bg-gradient-to-r from-red-500 to-red-700 px-4 py-3">
                            <h3 class="text-lg font-bold text-white">Section D</h3>
                            <p class="text-red-100 text-xs">Grade 10</p>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center">
                                <p class="text-gray-600 text-sm">Students: <span id="sectionDCount">0</span></p>
                                <button class="text-red-600 text-sm" onclick="viewSection('D')">View All</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-hover bg-white rounded-lg shadow-sm overflow-hidden border border-gray-100">
                        <div class="bg-gradient-to-r from-amber-500 to-amber-700 px-4 py-3">
                            <h3 class="text-lg font-bold text-white">Section E</h3>
                            <p class="text-amber-100 text-xs">Grade 10</p>
                        </div>
                        <div class="p-4">
                            <div class="flex justify-between items-center">
                                <p class="text-gray-600 text-sm">Students: <span id="sectionECount">0</span></p>
                                <button class="text-amber-600 text-sm" onclick="viewSection('E')">View All</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section Students View -->
            <div id="sectionStudentsView" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <button id="backToSectionsBtn" class="p-1 mr-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <h2 class="text-xl font-bold text-gray-800">Section <span id="currentSectionTitle">A</span></h2>
                    </div>
                    <div class="flex">
                        <input type="text" id="studentSearch" placeholder="Search..." class="border rounded-lg px-3 py-1 mr-2 text-sm">
                        <button id="addStudentToSectionBtn" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm">+ Add</button>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <table class="min-w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">ID</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">Name</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">Grade</th>
                                <th class="px-4 py-2 text-left text-xs font-medium text-gray-500">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="sectionStudentsTableBody" class="divide-y divide-gray-200"></tbody>
                    </table>
                    <div id="noStudentsMessage" class="py-6 text-center text-gray-500 hidden">
                        <p>No students found in this section</p>
                    </div>
                </div>
            </div>

            <!-- Student Dashboard View -->
            <div id="studentDashboardView" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <button id="backToSectionBtn" class="p-1 mr-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <h2 class="text-xl font-bold text-gray-800">Student Profile</h2>
                    </div>
                    <button id="editStudentBtn" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm">Edit</button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                    <!-- Student Profile Card -->
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-700 px-4 py-6 flex flex-col items-center">
                            <div id="studentPhoto" class="h-20 w-20 rounded-full mb-2 overflow-hidden">
                                <!-- Default avatar placeholder -->
                                <div class="avatar-placeholder h-full w-full" id="studentInitialsContainer">
                                    <span id="studentInitials">JS</span>
                                </div>
                                <!-- Image will be shown here if available -->
                                <img id="studentPhotoImg" class="h-full w-full object-cover hidden" src="" alt="">
                            </div>
                            <h3 class="text-lg font-bold text-white" id="studentName">John Smith</h3>
                            <p class="text-blue-100 text-xs" id="studentId">ID: ST12345</p>
                        </div>
                        <div class="p-4">
                            <p class="text-sm text-gray-500 mb-1">SECTION</p>
                            <p class="text-gray-800 mb-3" id="studentSection">Section A</p>
                            
                            <p class="text-sm text-gray-500 mb-1">DESCRIPTION</p>
                            <p class="text-gray-600 text-sm mb-3" id="studentDescription">No description available</p>
                            
                            <p class="text-sm text-gray-500 mb-1">CONTACT</p>
                            <p class="text-gray-600 text-sm" id="studentEmail">student@example.com</p>
                            <p class="text-gray-600 text-sm" id="studentPhone">(123) 456-7890</p>
                        </div>
                    </div>

                    <!-- Grades and Performance -->
                    <div class="lg:col-span-2 space-y-4">
                        <!-- Quarter Tabs -->
                        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                            <div class="border-b border-gray-200">
                                <div class="flex">
                                    <button class="quarter-tab tab-active px-4 py-2 text-sm" data-quarter="1">Q1</button>
                                    <button class="quarter-tab px-4 py-2 text-sm text-gray-500" data-quarter="2">Q2</button>
                                    <button class="quarter-tab px-4 py-2 text-sm text-gray-500" data-quarter="3">Q3</button>
                                    <button class="quarter-tab px-4 py-2 text-sm text-gray-500" data-quarter="4">Q4</button>
                                </div>
                            </div>
                            <div class="p-4">
                                <div class="flex justify-between items-center mb-3">
                                    <h3 class="text-md font-bold text-gray-800">Grade Components</h3>
                                    <button id="editGradesBtn" class="text-blue-600 text-sm">Edit</button>
                                </div>
                                
                                <div id="quarterGradesContainer" class="mb-4"></div>
                                
                                <div class="pt-3 border-t border-gray-200">
                                    <div class="flex justify-between items-center">
                                        <h4 class="font-bold text-gray-800">Quarter Average</h4>
                                        <p class="text-xl font-bold text-blue-600" id="quarterAverage">0.00</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Chart -->
                        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                            <div class="p-4">
                                <div class="flex justify-between items-center mb-3">
                                    <h3 class="text-md font-bold text-gray-800">Performance</h3>
                                    <div class="flex space-x-2">
                                        <button class="chart-type-btn bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs" data-type="quarter">Quarterly</button>
                                        <button class="chart-type-btn bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs" data-type="component">By Component</button>
                                    </div>
                                </div>
                                <div class="h-48">
                                    <canvas id="performanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Student Modal -->
    <div id="studentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md mx-4">
            <div class="bg-gradient-to-r from-blue-500 to-blue-700 px-4 py-3 flex justify-between items-center rounded-t-lg">
                <h3 class="text-lg font-bold text-white" id="studentModalTitle">Add Student</h3>
                <button id="closeStudentModal" class="text-white">&times;</button>
            </div>
            <div class="p-4">
                <form id="studentForm" class="space-y-3">
                    <input type="hidden" id="studentFormId">
                    
                    <div class="flex justify-center mb-2">
                        <div class="relative">
                            <div id="photoPreview" class="h-20 w-20 rounded-full overflow-hidden border-2 border-blue-500">
                                <div class="avatar-placeholder h-full w-full" id="photoInitials">
                                    <span>?</span>
                                </div>
                                <img id="photoPreviewImg" class="h-full w-full object-cover hidden" src="" alt="">
                            </div>
                            <div class="absolute bottom-0 right-0 flex">
                                <button type="button" id="uploadPhotoBtn" class="bg-blue-600 text-white rounded-full h-6 w-6 flex items-center justify-center mr-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H11V9.413l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13H5.5z" />
                                        <path d="M9 13h2v5a1 1 0 11-2 0v-5z" />
                                    </svg>
                                </button>
                                <button type="button" id="linkPhotoBtn" class="bg-green-600 text-white rounded-full h-6 w-6 flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Photo URL input (hidden by default) -->
                    <div id="photoUrlContainer" class="hidden">
                        <label class="block text-sm text-gray-700 mb-1">Photo URL</label>
                        <input type="url" id="photoUrl" class="w-full px-3 py-2 border rounded" placeholder="https://example.com/photo.jpg">
                        <p class="text-xs text-gray-500 mt-1">Enter a direct link to an image</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm text-gray-700 mb-1">First Name</label>
                            <input type="text" id="firstName" class="w-full px-3 py-2 border rounded" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-700 mb-1">Last Name</label>
                            <input type="text" id="lastName" class="w-full px-3 py-2 border rounded" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-700 mb-1">Student ID</label>
                        <input type="text" id="studentIdInput" class="w-full px-3 py-2 border rounded" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-700 mb-1">Section</label>
                        <select id="sectionSelect" class="w-full px-3 py-2 border rounded" required>
                            <option value="">Select Section</option>
                            <option value="A">Section A</option>
                            <option value="B">Section B</option>
                            <option value="C">Section C</option>
                            <option value="D">Section D</option>
                            <option value="E">Section E</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-700 mb-1">Description</label>
                        <textarea id="description" class="w-full px-3 py-2 border rounded" rows="2"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-700 mb-1">Email</label>
                        <input type="email" id="email" class="w-full px-3 py-2 border rounded" required>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-700 mb-1">Phone</label>
                        <input type="text" id="phone" class="w-full px-3 py-2 border rounded">
                    </div>
                    <div class="flex justify-end space-x-2 pt-2">
                        <button type="button" id="cancelStudentBtn" class="px-3 py-1 border rounded text-gray-700">Cancel</button>
                        <button type="submit" class="px-3 py-1 bg-blue-600 text-white rounded">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Grades Modal -->
    <div id="gradesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-md mx-4">
            <div class="bg-gradient-to-r from-blue-500 to-blue-700 px-4 py-3 flex justify-between items-center rounded-t-lg">
                <h3 class="text-lg font-bold text-white" id="gradesModalTitle">Edit Grades</h3>
                <button id="closeGradesModal" class="text-white">&times;</button>
            </div>
            <div class="p-4">
                <form id="gradesForm" class="space-y-4">
                    <div>
                        <h4 class="font-medium text-gray-800 mb-2">Performance Tasks</h4>
                        <div id="performanceTasksContainer" class="space-y-2"></div>
                        <button type="button" id="addPerformanceTaskBtn" class="mt-2 text-blue-600 text-sm">+ Add Task</button>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-800 mb-2">Written Works</h4>
                        <div id="writtenWorksContainer" class="space-y-2"></div>
                        <button type="button" id="addWrittenWorkBtn" class="mt-2 text-blue-600 text-sm">+ Add Work</button>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-800 mb-2">Quarterly Exam</h4>
                        <div class="flex items-center">
                            <input type="number" id="quarterlyExamScore" class="w-16 px-2 py-1 border rounded" min="0" max="100">
                            <span class="mx-2">/</span>
                            <input type="number" id="quarterlyExamTotal" class="w-16 px-2 py-1 border rounded" min="1" value="100">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="cancelGradesBtn" class="px-3 py-1 border rounded text-gray-700">Cancel</button>
                        <button type="submit" class="px-3 py-1 bg-blue-600 text-white rounded">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        const students = {};
        const sections = {
            'A':{name:'Section A',color:'blue'},
            'B':{name:'Section B',color:'purple'},
            'C':{name:'Section C',color:'green'},
            'D':{name:'Section D',color:'red'},
            'E':{name:'Section E',color:'amber'}
        };
        let currentSection = '';
        let currentStudent = '';
        let currentQuarter = 1;
        let currentChartType = 'quarter';
        let performanceChart = null;
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                if (document.getElementById('username').value === 'admin' && document.getElementById('password').value === 'password') {
                    document.getElementById('loginPage').classList.add('hidden');
                    document.getElementById('mainDashboard').classList.remove('hidden');
                    updateSectionCounts();
                } else {
                    alert('Invalid credentials');
                }
            });
            
            // Navigation
            document.getElementById('backToSectionsBtn').addEventListener('click', () => {
                showView('sectionsView');
                updateSectionCounts();
            });
            
            document.getElementById('backToSectionBtn').addEventListener('click', () => {
                showView('sectionStudentsView');
                populateSectionStudents(currentSection);
            });
            
            // Student modal
            document.getElementById('addStudentBtn').addEventListener('click', () => openStudentModal());
            document.getElementById('addStudentToSectionBtn').addEventListener('click', () => openStudentModal(currentSection));
            document.getElementById('closeStudentModal').addEventListener('click', closeStudentModal);
            document.getElementById('cancelStudentBtn').addEventListener('click', closeStudentModal);
            document.getElementById('studentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveStudent();
            });
            
            // Photo upload and link options
            document.getElementById('uploadPhotoBtn').addEventListener('click', simulatePhotoUpload);
            document.getElementById('linkPhotoBtn').addEventListener('click', togglePhotoUrlInput);
            document.getElementById('photoUrl').addEventListener('input', previewPhotoUrl);
            
            // Edit student
            document.getElementById('editStudentBtn').addEventListener('click', () => {
                if (currentStudent) openStudentModal(null, currentStudent);
            });
            
            // Quarter tabs
            document.querySelectorAll('.quarter-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    setActiveQuarter(parseInt(this.getAttribute('data-quarter')));
                });
            });
            
            // Grades modal
            document.getElementById('editGradesBtn').addEventListener('click', () => {
                if (currentStudent) openGradesModal();
            });
            document.getElementById('closeGradesModal').addEventListener('click', closeGradesModal);
            document.getElementById('cancelGradesBtn').addEventListener('click', closeGradesModal);
            document.getElementById('gradesForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveGrades();
            });
            
            // Add grade components
            document.getElementById('addPerformanceTaskBtn').addEventListener('click', () => addGradeComponent('performanceTasks'));
            document.getElementById('addWrittenWorkBtn').addEventListener('click', () => addGradeComponent('writtenWorks'));
            
            // Chart type
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    setChartType(this.getAttribute('data-type'));
                    document.querySelectorAll('.chart-type-btn').forEach(b => {
                        b.className = 'chart-type-btn bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs';
                    });
                    this.className = 'chart-type-btn bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs';
                });
            });
            
            // Search
            document.getElementById('studentSearch').addEventListener('input', function() {
                filterStudents(this.value.toLowerCase());
            });
        });
        
        // View management
        function showView(viewId) {
            ['sectionsView', 'sectionStudentsView', 'studentDashboardView'].forEach(view => {
                document.getElementById(view).classList.add('hidden');
            });
            document.getElementById(viewId).classList.remove('hidden');
        }
        
        // Section management
        function viewSection(section) {
            currentSection = section;
            document.getElementById('currentSectionTitle').textContent = section;
            showView('sectionStudentsView');
            populateSectionStudents(section);
        }
        
        function updateSectionCounts() {
            const counts = {'A':0,'B':0,'C':0,'D':0,'E':0};
            Object.values(students).forEach(student => {
                if (counts.hasOwnProperty(student.section)) counts[student.section]++;
            });
            for (const section in counts) {
                document.getElementById(`section${section}Count`).textContent = counts[section];
            }
        }
        
        function populateSectionStudents(section) {
            const tableBody = document.getElementById('sectionStudentsTableBody');
            const noMsg = document.getElementById('noStudentsMessage');
            tableBody.innerHTML = '';
            
            const sectionStudents = Object.values(students).filter(s => s.section === section);
            
            if (sectionStudents.length === 0) {
                tableBody.classList.add('hidden');
                noMsg.classList.remove('hidden');
                return;
            }
            
            tableBody.classList.remove('hidden');
            noMsg.classList.add('hidden');
            
            sectionStudents.forEach(student => {
                const avg = calculateStudentAverage(student);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-4 py-2 text-sm">${student.id}</td>
                    <td class="px-4 py-2 text-sm">${student.firstName} ${student.lastName}</td>
                    <td class="px-4 py-2 text-sm"><span class="px-2 py-1 rounded-full ${getGradeColorClass(avg)}">${avg.toFixed(1)}</span></td>
                    <td class="px-4 py-2 text-sm">
                        <button class="text-blue-600 mr-2" onclick="viewStudent('${student.id}')">View</button>
                        <button class="text-red-600" onclick="deleteStudent('${student.id}')">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function filterStudents(term) {
            const rows = document.getElementById('sectionStudentsTableBody').querySelectorAll('tr');
            rows.forEach(row => {
                const name = row.cells[1].textContent.toLowerCase();
                const id = row.cells[0].textContent.toLowerCase();
                row.style.display = (name.includes(term) || id.includes(term)) ? '' : 'none';
            });
        }
        
        // Student management
        function openStudentModal(section = null, studentId = null) {
            document.getElementById('studentModalTitle').textContent = studentId ? 'Edit Student' : 'Add Student';
            document.getElementById('studentForm').reset();
            
            // Hide photo URL input by default
            document.getElementById('photoUrlContainer').classList.add('hidden');
            
            if (section) document.getElementById('sectionSelect').value = section;
            
            // Reset photo preview
            document.getElementById('photoPreviewImg').classList.add('hidden');
            document.getElementById('photoInitials').classList.remove('hidden');
            document.getElementById('photoInitials').querySelector('span').textContent = '?';
            
            if (studentId && students[studentId]) {
                const student = students[studentId];
                document.getElementById('studentFormId').value = student.id;
                document.getElementById('firstName').value = student.firstName;
                document.getElementById('lastName').value = student.lastName;
                document.getElementById('studentIdInput').value = student.id;
                document.getElementById('sectionSelect').value = student.section;
                document.getElementById('description').value = student.description || '';
                document.getElementById('email').value = student.email;
                document.getElementById('phone').value = student.phone || '';
                document.getElementById('studentIdInput').disabled = true;
                
                // Show photo if available
                if (student.photo) {
                    document.getElementById('photoPreviewImg').src = student.photo;
                    document.getElementById('photoPreviewImg').classList.remove('hidden');
                    document.getElementById('photoInitials').classList.add('hidden');
                    
                    // If it's a URL (not data URL), show the URL input
                    if (student.photo.startsWith('http')) {
                        document.getElementById('photoUrlContainer').classList.remove('hidden');
                        document.getElementById('photoUrl').value = student.photo;
                    }
                } else {
                    const initials = (student.firstName.charAt(0) + student.lastName.charAt(0)).toUpperCase();
                    document.getElementById('photoInitials').querySelector('span').textContent = initials;
                }
            } else {
                document.getElementById('studentFormId').value = '';
                document.getElementById('studentIdInput').disabled = false;
            }
            
            document.getElementById('studentModal').classList.remove('hidden');
        }
        
        function closeStudentModal() {
            document.getElementById('studentModal').classList.add('hidden');
        }
        
        function togglePhotoUrlInput() {
            const container = document.getElementById('photoUrlContainer');
            container.classList.toggle('hidden');
            
            if (!container.classList.contains('hidden')) {
                document.getElementById('photoUrl').focus();
            }
        }
        
        function previewPhotoUrl() {
            const url = document.getElementById('photoUrl').value.trim();
            if (url) {
                // Preview the image
                document.getElementById('photoPreviewImg').src = url;
                document.getElementById('photoPreviewImg').classList.remove('hidden');
                document.getElementById('photoInitials').classList.add('hidden');
                
                // Add error handling for the image
                document.getElementById('photoPreviewImg').onerror = function() {
                    // If image fails to load, show initials instead
                    this.classList.add('hidden');
                    document.getElementById('photoInitials').classList.remove('hidden');
                    alert('Unable to load image from URL. Please check the link and try again.');
                };
            }
        }
        
        function simulatePhotoUpload() {
            // Generate a random avatar using a placeholder service
            const colors = ['1abc9c', '2ecc71', '3498db', 'e74c3c', 'f39c12', '9b59b6', '34495e'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            const firstName = document.getElementById('firstName').value || 'Student';
            const lastName = document.getElementById('lastName').value || '';
            const initials = (firstName.charAt(0) + (lastName.charAt(0) || '')).toUpperCase();
            
            // Create an SVG avatar
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
                    <rect width="100" height="100" fill="#${randomColor}"/>
                    <text x="50" y="50" font-family="Arial" font-size="40" fill="white" text-anchor="middle" dominant-baseline="central">${initials}</text>
                </svg>
            `;
            
            // Convert SVG to data URL
            const dataUrl = 'data:image/svg+xml;base64,' + btoa(svg);
            
            // Update preview
            document.getElementById('photoPreviewImg').src = dataUrl;
            document.getElementById('photoPreviewImg').classList.remove('hidden');
            document.getElementById('photoInitials').classList.add('hidden');
            
            // Hide URL input if it was visible
            document.getElementById('photoUrlContainer').classList.add('hidden');
            document.getElementById('photoUrl').value = '';
        }
        
        function saveStudent() {
            const formId = document.getElementById('studentFormId').value;
            const id = formId || document.getElementById('studentIdInput').value;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const section = document.getElementById('sectionSelect').value;
            const description = document.getElementById('description').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            
            // Get photo - prioritize URL if provided
            let photo = null;
            const photoUrl = document.getElementById('photoUrl').value.trim();
            if (photoUrl) {
                photo = photoUrl;
            } else if (!document.getElementById('photoPreviewImg').classList.contains('hidden')) {
                photo = document.getElementById('photoPreviewImg').src;
            }
            
            if (!students[id]) {
                students[id] = {
                    id, firstName, lastName, section, description, email, phone, photo,
                    grades: {
                        1: initGrades(),
                        2: initGrades(),
                        3: initGrades(),
                        4: initGrades()
                    }
                };
            } else {
                students[id].firstName = firstName;
                students[id].lastName = lastName;
                students[id].section = section;
                students[id].description = description;
                students[id].email = email;
                students[id].phone = phone;
                students[id].photo = photo;
            }
            
            closeStudentModal();
            
            if (document.getElementById('sectionsView').classList.contains('hidden')) {
                if (document.getElementById('sectionStudentsView').classList.contains('hidden')) {
                    if (currentStudent === id) viewStudent(id);
                } else {
                    populateSectionStudents(currentSection);
                }
            } else {
                updateSectionCounts();
            }
        }
        
        function deleteStudent(id) {
            if (confirm('Delete this student?')) {
                delete students[id];
                if (currentStudent === id) showView('sectionStudentsView');
                populateSectionStudents(currentSection);
                updateSectionCounts();
            }
        }
        
        function viewStudent(id) {
            if (!students[id]) return;
            
            currentStudent = id;
            const student = students[id];
            
            document.getElementById('studentName').textContent = `${student.firstName} ${student.lastName}`;
            document.getElementById('studentId').textContent = `ID: ${student.id}`;
            document.getElementById('studentSection').textContent = `Section ${student.section}`;
            document.getElementById('studentDescription').textContent = student.description || 'No description available';
            document.getElementById('studentEmail').textContent = student.email;
            document.getElementById('studentPhone').textContent = student.phone || 'Not provided';
            
            // Set initials or photo
            if (student.photo) {
                document.getElementById('studentPhotoImg').src = student.photo;
                document.getElementById('studentPhotoImg').classList.remove('hidden');
                document.getElementById('studentInitialsContainer').classList.add('hidden');
                
                // Add error handling for the image
                document.getElementById('studentPhotoImg').onerror = function() {
                    // If image fails to load, show initials instead
                    this.classList.add('hidden');
                    document.getElementById('studentInitialsContainer').classList.remove('hidden');
                    document.getElementById('studentInitials').textContent = (student.firstName.charAt(0) + student.lastName.charAt(0)).toUpperCase();
                };
            } else {
                document.getElementById('studentInitials').textContent = (student.firstName.charAt(0) + student.lastName.charAt(0)).toUpperCase();
                document.getElementById('studentPhotoImg').classList.add('hidden');
                document.getElementById('studentInitialsContainer').classList.remove('hidden');
            }
            
            setActiveQuarter(currentQuarter);
            updateChart();
            
            showView('studentDashboardView');
        }
        
        // Grade management
        function initGrades() {
            return {
                performanceTasks: [{name:'Task 1',score:0,total:100}],
                writtenWorks: [{name:'Work 1',score:0,total:100}],
                quarterlyExam: {score:0,total:100},
                weights: {performanceTasks:40,writtenWorks:40,quarterlyExam:20}
            };
        }
        
        function setActiveQuarter(quarter) {
            currentQuarter = quarter;
            document.querySelectorAll('.quarter-tab').forEach(tab => {
                tab.classList.remove('tab-active');
                tab.classList.add('text-gray-500');
            });
            const activeTab = document.querySelector(`.quarter-tab[data-quarter="${quarter}"]`);
            activeTab.classList.add('tab-active');
            activeTab.classList.remove('text-gray-500');
            
            if (currentStudent) loadQuarterGrades(quarter);
        }
        
        function loadQuarterGrades(quarter) {
            const student = students[currentStudent];
            if (!student) return;
            
            const grades = student.grades[quarter];
            const container = document.getElementById('quarterGradesContainer');
            container.innerHTML = '';
            
            // Performance Tasks
            const ptDiv = document.createElement('div');
            ptDiv.className = 'mb-3';
            ptDiv.innerHTML = `<p class="text-xs text-gray-500 mb-1">PERFORMANCE TASKS (${grades.weights.performanceTasks}%)</p>`;
            
            grades.performanceTasks.forEach(task => {
                const pct = (task.score/task.total*100).toFixed(1);
                ptDiv.innerHTML += `
                    <div class="flex justify-between text-sm mb-1">
                        <span>${task.name}</span>
                        <span>${task.score}/${task.total} <span class="text-xs ${getGradeColorClass(pct,true)}">${pct}%</span></span>
                    </div>
                `;
            });
            container.appendChild(ptDiv);
            
            // Written Works
            const wwDiv = document.createElement('div');
            wwDiv.className = 'mb-3';
            wwDiv.innerHTML = `<p class="text-xs text-gray-500 mb-1">WRITTEN WORKS (${grades.weights.writtenWorks}%)</p>`;
            
            grades.writtenWorks.forEach(work => {
                const pct = (work.score/work.total*100).toFixed(1);
                wwDiv.innerHTML += `
                    <div class="flex justify-between text-sm mb-1">
                        <span>${work.name}</span>
                        <span>${work.score}/${work.total} <span class="text-xs ${getGradeColorClass(pct,true)}">${pct}%</span></span>
                    </div>
                `;
            });
            container.appendChild(wwDiv);
            
            // Exam
            const examDiv = document.createElement('div');
            const examPct = (grades.quarterlyExam.score/grades.quarterlyExam.total*100).toFixed(1);
            examDiv.innerHTML = `
                <p class="text-xs text-gray-500 mb-1">QUARTERLY EXAM (${grades.weights.quarterlyExam}%)</p>
                <div class="flex justify-between text-sm">
                    <span>Quarterly Exam</span>
                    <span>${grades.quarterlyExam.score}/${grades.quarterlyExam.total} <span class="text-xs ${getGradeColorClass(examPct,true)}">${examPct}%</span></span>
                </div>
            `;
            container.appendChild(examDiv);
            
            // Average
            const avg = calcQuarterAvg(grades);
            document.getElementById('quarterAverage').textContent = avg.toFixed(2);
            document.getElementById('quarterAverage').className = `text-xl font-bold ${getGradeColorClass(avg)}`;
        }
        
        function openGradesModal() {
            const student = students[currentStudent];
            if (!student) return;
            
            const grades = student.grades[currentQuarter];
            document.getElementById('gradesModalTitle').textContent = `Edit Grades - Q${currentQuarter}`;
            
            // Performance Tasks
            const ptContainer = document.getElementById('performanceTasksContainer');
            ptContainer.innerHTML = '';
            
            grades.performanceTasks.forEach((task, i) => {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-2';
                div.innerHTML = `
                    <input type="text" class="pt-name flex-grow px-2 py-1 border rounded text-sm" value="${task.name}">
                    <input type="number" class="pt-score w-12 px-2 py-1 border rounded text-sm" min="0" value="${task.score}">
                    <span>/</span>
                    <input type="number" class="pt-total w-12 px-2 py-1 border rounded text-sm" min="1" value="${task.total}">
                    <button type="button" class="delete-pt text-red-500" data-index="${i}">&times;</button>
                `;
                ptContainer.appendChild(div);
            });
            
            ptContainer.querySelectorAll('.delete-pt').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (ptContainer.children.length > 1) this.parentElement.remove();
                });
            });
            
            // Written Works
            const wwContainer = document.getElementById('writtenWorksContainer');
            wwContainer.innerHTML = '';
            
            grades.writtenWorks.forEach((work, i) => {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-2';
                div.innerHTML = `
                    <input type="text" class="ww-name flex-grow px-2 py-1 border rounded text-sm" value="${work.name}">
                    <input type="number" class="ww-score w-12 px-2 py-1 border rounded text-sm" min="0" value="${work.score}">
                    <span>/</span>
                    <input type="number" class="ww-total w-12 px-2 py-1 border rounded text-sm" min="1" value="${work.total}">
                    <button type="button" class="delete-ww text-red-500" data-index="${i}">&times;</button>
                `;
                wwContainer.appendChild(div);
            });
            
            wwContainer.querySelectorAll('.delete-ww').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (wwContainer.children.length > 1) this.parentElement.remove();
                });
            });
            
            // Exam
            document.getElementById('quarterlyExamScore').value = grades.quarterlyExam.score;
            document.getElementById('quarterlyExamTotal').value = grades.quarterlyExam.total;
            
            document.getElementById('gradesModal').classList.remove('hidden');
        }
        
        function closeGradesModal() {
            document.getElementById('gradesModal').classList.add('hidden');
        }
        
        function saveGrades() {
            const student = students[currentStudent];
            if (!student) return;
            
            // Performance Tasks
            const ptNames = document.querySelectorAll('.pt-name');
            const ptScores = document.querySelectorAll('.pt-score');
            const ptTotals = document.querySelectorAll('.pt-total');
            
            const performanceTasks = [];
            for (let i = 0; i < ptNames.length; i++) {
                performanceTasks.push({
                    name: ptNames[i].value,
                    score: parseInt(ptScores[i].value) || 0,
                    total: parseInt(ptTotals[i].value) || 1
                });
            }
            
            // Written Works
            const wwNames = document.querySelectorAll('.ww-name');
            const wwScores = document.querySelectorAll('.ww-score');
            const wwTotals = document.querySelectorAll('.ww-total');
            
            const writtenWorks = [];
            for (let i = 0; i < wwNames.length; i++) {
                writtenWorks.push({
                    name: wwNames[i].value,
                    score: parseInt(wwScores[i].value) || 0,
                    total: parseInt(wwTotals[i].value) || 1
                });
            }
            
            // Exam
            const quarterlyExam = {
                score: parseInt(document.getElementById('quarterlyExamScore').value) || 0,
                total: parseInt(document.getElementById('quarterlyExamTotal').value) || 1
            };
            
            // Update student grades
            student.grades[currentQuarter] = {
                performanceTasks,
                writtenWorks,
                quarterlyExam,
                weights: {performanceTasks:40, writtenWorks:40, quarterlyExam:20}
            };
            
            closeGradesModal();
            loadQuarterGrades(currentQuarter);
            updateChart();
        }
        
        function addGradeComponent(type) {
            const container = document.getElementById(type === 'performanceTasks' ? 'performanceTasksContainer' : 'writtenWorksContainer');
            const div = document.createElement('div');
            div.className = 'flex items-center space-x-2';
            
            const className = type === 'performanceTasks' ? 'pt' : 'ww';
            const name = type === 'performanceTasks' ? 'Task ' : 'Work ';
            const num = container.children.length + 1;
            
            div.innerHTML = `
                <input type="text" class="${className}-name flex-grow px-2 py-1 border rounded text-sm" value="${name}${num}">
                <input type="number" class="${className}-score w-12 px-2 py-1 border rounded text-sm" min="0" value="0">
                <span>/</span>
                <input type="number" class="${className}-total w-12 px-2 py-1 border rounded text-sm" min="1" value="100">
                <button type="button" class="delete-${className} text-red-500">&times;</button>
            `;
            
            container.appendChild(div);
            
            div.querySelector(`.delete-${className}`).addEventListener('click', function() {
                if (container.children.length > 1) this.parentElement.remove();
            });
        }
        
        // Helper functions
        function calcComponentAvg(components) {
            if (components.length === 0) return 0;
            let totalScore = 0, totalPossible = 0;
            components.forEach(c => {
                totalScore += c.score;
                totalPossible += c.total;
            });
            return totalPossible > 0 ? (totalScore / totalPossible) * 100 : 0;
        }
        
        function calcQuarterAvg(grades) {
            const ptAvg = calcComponentAvg(grades.performanceTasks);
            const wwAvg = calcComponentAvg(grades.writtenWorks);
            const examAvg = grades.quarterlyExam.total > 0 ? (grades.quarterlyExam.score / grades.quarterlyExam.total) * 100 : 0;
            
            return (
                (ptAvg * grades.weights.performanceTasks / 100) +
                (wwAvg * grades.weights.writtenWorks / 100) +
                (examAvg * grades.weights.quarterlyExam / 100)
            );
        }
        
        function calculateStudentAverage(student) {
            let total = 0, count = 0;
            for (let q = 1; q <= 4; q++) {
                const avg = calcQuarterAvg(student.grades[q]);
                if (avg > 0) {
                    total += avg;
                    count++;
                }
            }
            return count > 0 ? total / count : 0;
        }
        
        function getGradeColorClass(grade, isText = false) {
            if (grade >= 90) return isText ? 'text-green-600' : 'bg-green-100 text-green-800';
            if (grade >= 80) return isText ? 'text-blue-600' : 'bg-blue-100 text-blue-800';
            if (grade >= 75) return isText ? 'text-yellow-600' : 'bg-yellow-100 text-yellow-800';
            return isText ? 'text-red-600' : 'bg-red-100 text-red-800';
        }
        
        function setChartType(type) {
            currentChartType = type;
            updateChart();
        }
        
        function updateChart() {
            const student = students[currentStudent];
            if (!student) return;
            
            if (performanceChart) performanceChart.destroy();
            
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            if (currentChartType === 'quarter') {
                // Quarterly chart
                const data = [1,2,3,4].map(q => calcQuarterAvg(student.grades[q]));
                
                performanceChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                        datasets: [{
                            label: 'Average',
                            data: data,
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            } else {
                // Component chart
                const grades = student.grades[currentQuarter];
                const ptAvg = calcComponentAvg(grades.performanceTasks);
                const wwAvg = calcComponentAvg(grades.writtenWorks);
                const examAvg = grades.quarterlyExam.total > 0 ? (grades.quarterlyExam.score / grades.quarterlyExam.total) * 100 : 0;
                
                performanceChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Performance', 'Written', 'Exam'],
                        datasets: [{
                            data: [ptAvg, wwAvg, examAvg],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.6)',
                                'rgba(139, 92, 246, 0.6)',
                                'rgba(16, 185, 129, 0.6)'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'95329f257414b9f5',t:'MTc1MDQ5OTYzNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
